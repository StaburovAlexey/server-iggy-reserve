# Server Iggy Reserve

REST API сервер для системы бронирования столов Iggy с авторизацией по JWT, загрузкой файлов, интеграцией с Telegram-ботом и автоматическим резервным копированием.

## Описание проекта

Это серверное приложение, разработанное для системы бронирования столов Iggy. Предоставляет REST API с JWT-аутентификацией, поддержкой загрузки файлов, интеграцией с Telegram-ботом и автоматическим резервным копированием. Проект создан как часть комплексной системы управления бронированиями для бара Iggy Taproom.

## Основные функции

### Управление бронированиями
- CRUD операции для бронирования столов через REST API
- endpoints: `/tables`, `/tables/add`, `/tables/delete/:id`
- Поддержка фильтрации и поиска бронирований

### Управление пользователями
- JWT-аутентификация
- Регистрация новых пользователей (только администратором)
- Обновление собственных данных пользователя
- Ролевая система доступа

### Безопасность и настройки
- Зашифрованное хранение чувствительных данных (bot_id, chat_id, admin_chat) с использованием AES-256-GCM
- Выдача настроек только администратору
- Защита от несанкционированного доступа

### Загрузка файлов
- Загрузка аватаров (JPEG/PNG до 2 МБ)
- Генерация прямых ссылок на загруженные файлы
- Хранение файлов в директории /uploads

### Интеграция с Telegram
- Telegram-бот, который отвечает на сообщения в чате
- Автоматическое резервное копирование данных (база данных и загруженные файлы) в 00:00 и 08:00 по времени сервера

### QR Magic-Link функциональность
- Создание одноразовых ссылок для авторизации через QR-коды
- Поддержка подтверждения по электронной почте
- Возможность обновления существующих учетных записей
- Управляемый срок действия ссылок через `MAGIC_LINK_TTL_MINUTES`

## Технологии

- **Язык программирования**: JavaScript
- **Среда выполнения**: Node.js
- **База данных**: SQLite
- **Аутентификация**: JWT (JSON Web Tokens)
- **Шифрование**: AES-256-GCM для чувствительных данных
- **Загрузка файлов**: Multipart/form-data
- **Фреймворк**: Express.js (подразумевается из описания)
- **Криптография**: 32-байтовые ключи шифрования

## Основные Endpoints

### Аутентификация
- `POST /login` - аутентификация пользователя
- `POST /registration` - регистрация (только для администраторов)

### Пользователи
- `PUT /users/me` - обновление пользовательских данных

### Бронирования
- `GET /tables` - получение списка бронирований
- `POST /tables/add` - добавление бронирования
- `DELETE /tables/delete/:id` - удаление бронирования

### Настройки
- `GET /settings` - получение настроек (только для администраторов)
- `POST /settings` - обновление настроек (только для администраторов)
- `POST /settings/add` - смена Telegram-бота

### Загрузка файлов
- `POST /upload` - загрузка файлов (аватаров)

### Magic-Links
- `POST /magic-links` - создание одноразовых ссылок для авторизации

## Безопасность

- Шифрование чувствительных данных с использованием AES-256-GCM
- JWT-аутентификация с безопасным управлением токенами
- Защита от несанкционированного доступа к чувствительным endpoint'ам
- Проверка типов файлов и ограничение размера при загрузке

## Автоматическое резервное копирование

- Автобэкап в 00:00 и 08:00 (время сервера)
- Отправка zip-архива с базой данных (директория `/data`) и файлами (директория `/uploads`) администратору
- Для отправки автобэкапов необходимо указать `admin_chat` и `bot_id` в настройках

## Фронтенд-интеграция

Этот сервер интегрируется с фронтенд-приложением, расположенным по адресу: [https://github.com/StaburovAlexey/iggy-reservation-vue](https://github.com/StaburovAlexey/iggy-reservation-vue)

## Лицензия

Данный проект разработан как часть личной инициативы, которая была принята организацией для внутреннего использования.

---

<div align="center">

Создано с ❤️ для команды Iggy Taproom

</div>